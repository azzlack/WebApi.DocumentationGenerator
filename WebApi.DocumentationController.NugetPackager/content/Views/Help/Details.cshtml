@using System.Net.Http
@using System.Web.Http.Description
@using System.Web.Mvc
@model WebApi.DocumentationController.ViewModels.ApiExplorerDetailsViewModel

@{
    ViewBag.Title = Model.ApiControllerDescription.Name;
    ViewBag.Header = Model.ApiControllerDescription.Name;
    Layout = "~/Views/Help/_HelpLayout.cshtml";
}

<section class="content-wrapper main-content clear-fix">
    <h1>@Model.ApiControllerDescription.Name</h1>

    <ul class="actions">
        @foreach (var action in Model.ApiControllerDescription.Actions)
        {
            <li class="action">
                <table class="routes">
                    @*@foreach (var route in Model.AttributeRoutes.Where(x => x.Defaults.Any(c => (c.Key.Equals("action") && c.Value.ToString().Equals(description.ActionDescriptor.ActionName)))))
                    {
                        <tr>
                            @{
                                var httpMethodConstraint = route.Constraints.Values.OfType<AttributeRouting.Web.Constraints.RestfulHttpMethodConstraint>().FirstOrDefault();
                            }
                            <td>@httpMethodConstraint.AllowedMethods.FirstOrDefault()</td><td>@route.Url</td>
                        </tr>
                    }*@
                    @foreach (var route in action.Routes)
                    {
                        <tr>
                            <td>@route.Method</td><td>@route.Path</td>
                        </tr>
                    }
                </table>
                <p>@MvcHtmlString.Create(action.Summary.Replace(Environment.NewLine, "<br/>"))</p>
                <table>
                    @if (!string.IsNullOrEmpty(action.Example)) 
                    {
                        <tr><td>Example:</td><td>@MvcHtmlString.Create(action.Example.Replace(Environment.NewLine, "<br/>"))</td></tr>
                    }
                    @if (!string.IsNullOrEmpty(action.Remarks))
                    {
                        <tr><td>Remarks:</td><td>@MvcHtmlString.Create(action.Remarks.Replace(Environment.NewLine, "<br/>"))</td></tr>
                    }
                    @if (!string.IsNullOrEmpty(action.Returns))
                    {
                        <tr><td>Returns:</td><td>@MvcHtmlString.Create(action.Returns.Replace(Environment.NewLine, "<br/>"))</td></tr>
                    }
                </table>
                
                @if (action.ParameterDescriptions.Any())
                {
                    <h5>Parameters:</h5>
                    <table class="parameters">
                        @foreach (var parameter in action.ParameterDescriptions.Where(x => x.Source == ApiParameterSource.FromUri))
                        {
                            <tr>
                                <td>@parameter.Name</td><td>@parameter.Documentation</td><td>(URI)</td>
                            </tr>
                        }
                        @foreach (var parameter in action.ParameterDescriptions.Where(x => x.Source == ApiParameterSource.FromBody))
                        {
                            <tr>
                                <td>@parameter.Name</td><td>@parameter.Documentation</td><td>(Body)</td>
                            </tr>
                        }
                    </table>
                }
            </li>
        }
    </ul>
</section>